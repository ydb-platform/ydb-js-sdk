# YDB Query Example

Этот пример демонстрирует выполнение SQL‑запросов с помощью YDB JavaScript SDK.

## Что демонстрирует

- **Создание таблиц** с различными типами данных (Uint64, Text, Timestamp, Json)
- **Параметризованные запросы** с безопасной передачей параметров
- **Работа с массивами данных** через AS_TABLE()
- **JSON‑операции** для работы с метаданными
- **Правильное управление ресурсами** (закрытие соединения)
- **Обработка ошибок** с try/catch

## Запуск

```bash
# Установите зависимости
npm install

# Запустите пример
npm start

# Запустите с отладочной информацией
npm run dev
```

## Переменные окружения

- `YDB_CONNECTION_STRING` - строка подключения к YDB (по умолчанию: `grpc://localhost:2136/local`)

## Что происходит в примере

1. **Подключение к YDB** и ожидание готовности
2. **Создание таблицы** `test_table` с колонками разных типов
3. **Вставка тестовых данных** с использованием AS_TABLE()
4. **Поиск записи по ID** с параметризованным запросом
5. **Подсчёт общего количества** записей
6. **JSON-запрос** для поиска записей по тегам в метаданных
7. **Закрытие соединения** для освобождения ресурсов

## Лучшие практики из примера

### ✅ Правильное управление ресурсами

```javascript
try {
  // работа с базой данных
} finally {
  driver.close() // всегда закрывайте соединение
}
```

### ✅ Параметризованные запросы

```javascript
let searchId = 2n
let result = await sql`SELECT * FROM table WHERE id = ${searchId}`
```

### ✅ Работа с JSON в YDB

```javascript
// Поиск по JSON-полю
await sql`SELECT * FROM table
    WHERE JSON_EXISTS(metadata, "$.tags[*]" PASSING ${tag} AS target
        WHERE @ == target)`
```

### ✅ Массовая вставка данных

```javascript
let data = [{ id: 1n, name: 'test' }, ...]
await sql`INSERT INTO table SELECT * FROM AS_TABLE(${data})`
```

## Рекомендации

- **Используйте TypeScript** для лучшей типизации результатов
- **Обрабатывайте ошибки** с помощью try/catch
- **Всегда закрывайте соединения** в finally блоке
- **Используйте параметры** вместо конкатенации строк
- **Изучите YDB типы** в пакете `@ydbjs/value`

## Использование

Скопируйте эту папку в свой проект и адаптируйте код под ваши потребности:

```bash
cp -r examples/query my-ydb-query-project
cd my-ydb-query-project
npm install
npm start
```

## Дополнительные возможности

Для более сложных сценариев изучите:

- **Транзакции** с `sql.begin()` или `sql.transaction()`
- **Статистику запросов** с `.withStats()`
- **Различные уровни изоляции** транзакций
- **Обработку на основе событий (event‑based)** для больших результатов
